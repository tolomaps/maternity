function initialize(){setMap()}function setMap(){function e(e,t,o){for(var i=colorScale(t),n=o.objects.countries.geometries,l=0;l<t.length;l++)for(var c=t[l],s=c.code3,u=0;u<n.length;u++)if(n[u].properties.code3==s){for(var d in keyArray)if("MaternalLeave"==keyArray[d]||"PaternalLeave"==keyArray[d]){var h=keyArray[d],p=c[h];n[u].properties[h]=p}else if("FertilityRate"==keyArray[d]){var h=keyArray[d],p=c[h];n[u].properties[h]=p}else{var h=keyArray[d],p=parseFloat(c[h]);n[u].properties[h]=p}break}{var o=r.selectAll(".countries").data(topojson.feature(o,o.objects.countries).features).enter().append("path").attr("class",function(e){return"countries "+e.properties.code3}).attr("d",function(e){return a(e)}).style("fill",function(e){return choropleth(e,i)}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel);o.append("desc").text(function(e){return choropleth(e,i)})}createDropdown(t),setChart(t,i),createDescriptions(t),about()}{var r=d3.select("body").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","map"),t=(d3.select("body").append("text").attr("class","pageTitle").html("Modern Motherhood:<br>A World of Struggle"),d3.geo.naturalEarth().scale(170).translate([mapWidth/2,mapHeight/2]).precision(.1)),a=d3.geo.path().projection(t),o=d3.geo.graticule();r.append("path").datum(o.outline).attr("class","gratBackground").attr("d",a),r.selectAll(".gratLines").data(o.lines).enter().append("path").attr("class","gratLines").attr("d",a)}queue().defer(d3.csv,"data/maternityData.csv").defer(d3.json,"data/countries.topojson").await(e)}function createDropdown(e){var r=d3.select("body").append("div").attr("class","dropdown").html("<h3>Select an Indicator:</h3>").append("select").on("change",function(){changeAttribute(this.value,e)});r.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return"MaternalLeave"==e?e=title_MaternalLeave:"PaternalLeave"==e?e="Paternity Leave Law":"MaternalDeath"==e?e=title_MaternalDeath:"FemaleLaborForceTotal"==e?e=title_FemaleLaborForceTotal:"FemaleLaborForceParticipationRate"==e?e=title_FemaleLaborForceParticipationRate:"FertilityRate"==e&&(e=title_FertilityRate),e})}function changeAttribute(e,r){currentVariable=e,colorize=colorScale(r),d3.selectAll(".countries").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)});var t=d3.selectAll(".square");updateChart(t,r.length,r),updateDescriptions(r)}function colorScale(e){"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?(scale=d3.scale.ordinal(),currentColors=ordinalColorArray):"MaternalDeath"==currentVariable?(scale=d3.scale.threshold(),currentColors=deathColorArray):(scale=d3.scale.threshold(),currentColors=colorArray),scale=scale.range(currentColors);for(var r in e)"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?currentArray=maternalLeaveArray:"MaternalDeath"==currentVariable?currentArray=[100,500,1e3,5e3,5e4]:"FemaleLaborForceTotal"==currentVariable?currentArray=[30,40,45,50,60]:"FemaleLaborForceParticipationRate"==currentVariable?currentArray=[30,50,57,65,100]:"FertilityRate"==currentVariable&&(currentArray=[1.5,2,3,5,8]);return scale.domain(currentArray),scale}function choropleth(e,r){var t=e.properties?e.properties[currentVariable]:e[currentVariable];return t?r(t):"No data"==t?"#ccc":"#ccc"}function setChart(e){chart=d3.select("body").append("svg").attr("width",chartWidth).attr("height",chartHeight).attr("class","chart"),chartTitle=d3.select("body").append("text").attr("class","chartTitle"),chartLabels=d3.select("body").append("div").attr("class","chartLabels");var r=chart.selectAll(".square").data(e).enter().append("rect").attr("class",function(e){return"square "+e.code3}).attr("width",squareWidth+"px").attr("height",squareHeight+"px");updateChart(r,e.length,e)}function updateChart(e,r,t){colorize=colorScale(t);{var a=0,o=[];chartLabels.html(function(){return"MaternalLeave"==currentVariable?currentArray[0]+"<br>"+currentArray[1]+"<br>"+currentArray[2]+"<br>"+currentArray[3]+"<br>"+currentArray[4]+"<br>":"MaternalDeath"==currentVariable?"1:"+currentArray[0]+"<br>1:"+currentArray[1]+"<br>1:"+currentArray[2]+"<br>1:"+currentArray[3]+"<br>1:"+currentArray[4]+"<br>":"FemaleLaborForceTotal"==currentVariable?currentArray[0]+"%<br>"+currentArray[1]+"%<br>"+currentArray[2]+"%<br>"+currentArray[3]+"%<br>"+currentArray[4]+"%<br>":"FemaleLaborForceParticipationRate"==currentVariable?currentArray[0]+"%<br>"+currentArray[1]+"%<br>"+currentArray[2]+"%<br>"+currentArray[3]+"%<br>"+currentArray[4]+"%<br>":"FertilityRate"==currentVariable?currentArray[0]+"<br>"+currentArray[1]+"<br>"+currentArray[2]+"<br>"+currentArray[3]+"<br>"+currentArray[4]+"<br>":void 0})}for(i=0;i<currentColors.length;i++){var n={color:currentColors[i],count:0};o.push(n)}e.style("fill",function(e){return choropleth(e,colorize)}).attr("x",function(e,r){for(color=choropleth(e,colorize),r=0;r<o.length;r++)o[r].color==color&&(a=o[r].count*(squareWidth+1),o[r].count+=1),("#ccc"==color||void 0==color)&&(a=-1e5);return a}).attr("y",function(e){return color=choropleth(e,colorize),color==currentColors[0]?0:color==currentColors[1]?squareHeight+1:color==currentColors[2]?2*(squareHeight+1):color==currentColors[3]?3*(squareHeight+1):color==currentColors[4]?4*(squareHeight+1):color==currentColors[5]?5*(squareHeight+1):void 0}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel)}function highlight(e){var r=e.properties?e.properties:e;d3.selectAll("."+r.code3).style("fill","#f7eb3e");var t,a=r[currentVariable]+"<br>"+currentVariable;t=void 0==r.name_long?r.Country:r.name_long,1==Boolean(r[currentVariable])?"MaternalLeave"==currentVariable?a=r[currentVariable]:"MaternalDeath"==currentVariable?a="1 in "+r[currentVariable]+"<br>women die from maternal causes":"FemaleLaborForceTotal"==currentVariable?a=Math.round(r[currentVariable])+"% of the labor force is composed of women":"FemaleLaborForceParticipationRate"==currentVariable?a=Math.round(r[currentVariable])+"% of women work":"FertilityRate"==currentVariable&&(a=Math.round(10*r[currentVariable])/10+"<br>Average Number of Children Per Woman"):a="No data";d3.select("body").append("div").attr("class","infoLabel").attr("id",r.code3+"label").html(t).append("div").html(a).attr("class","labelName")}function dehighlight(e){var r=e.properties?e.properties:e,t=d3.selectAll("."+r.code3),a=t.select("desc").text();t.style("fill",a);d3.select("#"+r.code3+"label").remove()}function moveLabel(){var e=d3.event.clientX<window.innerWidth-245?d3.event.clientX+10:d3.event.clientX-210,r=d3.event.clientY<window.innerHeight-100?d3.event.clientY-75:d3.event.clientY-175;d3.select(".infoLabel").style("margin-left",e+"px").style("margin-top",r+"px")}function createDescriptions(e){descriptionDiv=d3.select("body").append("div").attr("class","descriptionDiv"),updateDescriptions(e)}function updateDescriptions(){descriptionTitle=descriptionDiv.html(function(){return"MaternalLeave"==currentVariable?title_MaternalLeave+"<br>":"MaternalDeath"==currentVariable?title_MaternalDeath+"<br>":"FemaleLaborForceTotal"==currentVariable?title_FemaleLaborForceTotal+"<br>":"FemaleLaborForceParticipationRate"==currentVariable?title_FemaleLaborForceParticipationRate+"<br>":"FertilityRate"==currentVariable?title_FertilityRate+"<br>":void 0}).attr("class","descriptionTitle"),description=descriptionDiv.append("text").html(function(){return"MaternalLeave"==currentVariable?desc_MaternalLeave:"MaternalDeath"==currentVariable?desc_MaternalDeath:"FemaleLaborForceTotal"==currentVariable?desc_FemaleLaborForceTotal:"FemaleLaborForceParticipationRate"==currentVariable?desc_FemaleLaborForceParticipationRate:"FertilityRate"==currentVariable?desc_FertilityRate:void 0}).attr("class","description")}function about(){d3.select("body").append("div").attr("class","about").html("About: <br>").append("div").html("This website was created by Robin Tolochko in Fall 2014 | <a href='http://www.tolomaps.com' target='_blank'>Website</a> | <a href='http://www.twitter.com/tolomaps' target='_blank'>Twitter</a><br><br>I was initially inspired to map these topics by this <a href='http://www.nytimes.com/imagepages/2013/02/17/opinion/17coontz2-map.html' target='_blank'>NYTimes map</a> of maternity leave policies worldwide, which was published right before I got pregnant. It seemed odd that, as a working woman, Bogota, Colombia (where I was living at the time) was a better place to have a kid than the United States.<br><br>I am under no illusion that the maternal leave map is indicative of the actual situation in each country; I am aware that in many countries, the official policy may be that women get paid maternal leave, but the reality is that many women don't have formal employment or may not qualify for other reasons. This is a subject I'd like to explore further.<br><br>The Maternal Death indicator shocked me. In too many countries, the rate is higher than 1:50, meaning that 1 in 50 women will die from some maternal cause. I cannot fathom this.").attr("class","aboutText"),d3.select(".about").append("text").html("<br><br><sup>[1]</sup>Data for Maternity Leave Law (Year Unknown) is from the <a href='http://worldpolicyforum.org/tables/workplace-policies-childbirth/' target='_blank'>World Policy Forum</a><br><sup>[2]</sup>All other data is from the <a href='http://data.worldbank.org/indicator' target='_blank'>World Bank</a>: Lifetime Risk of Maternal Death (2013), Women as Percentage of Labor Force (2012), Women Labor Force Participation Rate (2012), and Fertility Rate (2012)").attr("class","sources")}var keyArray=["MaternalLeave","MaternalDeath","FemaleLaborForceTotal","FemaleLaborForceParticipationRate","FertilityRate"];ordinalColorArray=["#fb6a4a","#bcbddc","#9e9ac8","#756bb1","#54278f","#ccc"],deathColorArray=["#a82204","#eb2f05","#fb6a4a","#fca18c","#fed7cf"],colorArray=["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],maternalLeaveArray=["No paid leave","Less than 14 weeks","14 - 25 weeks","26 - 51 weeks","52 weeks or more","No data"];var currentVariable=keyArray[0],currentColors=[],currentArray=[],jsonCountries,colorize,mapWidth=1e3,mapHeight=500,chartTitle,chartLabels=[],squareWidth=10,squareHeight=25,chart,chartWidth=900,chartHeight=5*squareHeight+5,scale,description,title_MaternalLeave="Maternity Leave Law",title_MaternalDeath="Lifetime Risk of Maternal Death",title_FemaleLaborForceTotal="Women as Percentage of Labor Force",title_FemaleLaborForceParticipationRate="Women Labor Force Participation Rate",title_FertilityRate="Fertility Rate",descriptionDiv,desc_MaternalLeave="Length of paid maternal leave<sup>[1]</sup>",desc_MaternalDeath="The probability that a 15-year-old female will die eventually from a maternal cause assuming that current levels of fertility and mortality (including maternal mortality) do not change in the future, taking into account competing causes of death.<sup>[2]</sup>",desc_FemaleLaborForceTotal="Shows the extent to which women are active in the labor force. Labor force comprises people ages 15 and older who meet the International Labour Organization's definition of the economically active population.<sup>[2]</sup>",desc_FemaleLaborForceParticipationRate="Proportion of the female population ages 15 and older that is economically active: all people who supply labor for the production of goods and services during a specified period<sup>[2]</sup>",desc_FertilityRate="Represents the number of children that would be born to a woman if she were to live to the end of her childbearing years and bear children in accordance with current fertility rates.<sup>[2]</sup>",range;window.onload=initialize();