function initialize(){setMap()}function setMap(){function e(e,t,o){for(var l=colorScale(t),i=o.objects.countries.geometries,n=0;n<t.length;n++)for(var c=t[n],s=c.code3,u=0;u<i.length;u++)if(i[u].properties.code3==s){for(var d in keyArray)if("MaternalLeave"==keyArray[d]||"PaternalLeave"==keyArray[d]){var h=keyArray[d],b=c[h];i[u].properties[h]=b}else if("FertilityRate"==keyArray[d]){var h=keyArray[d],b=Math.round(10*c[h])/10;i[u].properties[h]=b}else{var h=keyArray[d],b=Math.round(parseFloat(c[h]));i[u].properties[h]=b}break}{var o=r.selectAll(".countries").data(topojson.feature(o,o.objects.countries).features).enter().append("path").attr("class",function(e){return"countries "+e.properties.code3}).attr("d",function(e){return a(e)}).style("fill",function(e){return choropleth(e,l)}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel);o.append("desc").text(function(e){return choropleth(e,l)})}createDropdown(t),setChart(t,l)}{var r=d3.select("body").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","map"),t=(d3.select("body").append("text").attr("class","pageTitle").html("Modern Motherhood:<br>A World of Struggle"),d3.geo.naturalEarth().scale(170).translate([mapWidth/2,mapHeight/2]).precision(.1)),a=d3.geo.path().projection(t),o=d3.geo.graticule();r.append("path").datum(o.outline).attr("class","gratBackground").attr("d",a),r.selectAll(".gratLines").data(o.lines).enter().append("path").attr("class","gratLines").attr("d",a)}queue().defer(d3.csv,"data/maternityData.csv").defer(d3.json,"data/countries.topojson").await(e)}function createDropdown(e){var r=d3.select("body").append("div").attr("class","dropdown").html("<h3>Select a Statistic:</h3>").append("select").on("change",function(){changeAttribute(this.value,e)});r.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return"MaternalLeave"==e?e=title_MaternalLeave:"PaternalLeave"==e?e="Paternity Leave Law":"MaternalDeath"==e?e=title_MaternalDeath:"FemaleLaborForceTotal"==e?e=title_FemaleLaborForceTotal:"FemaleLaborForceParticipationRate"==e?e=title_FemaleLaborForceParticipationRate:"FertilityRate"==e&&(e=title_FertilityRate),e})}function changeAttribute(e,r){currentVariable=e,colorize=colorScale(r),d3.selectAll(".countries").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)});var t=d3.selectAll(".square");updateChart(t,r.length,r)}function colorScale(e){"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?(scale=d3.scale.ordinal(),currentColors=ordinalColorArray):"MaternalDeath"==currentVariable?(scale=d3.scale.threshold(),currentColors=deathColorArray):(scale=d3.scale.threshold(),currentColors=colorArray),scale=scale.range(currentColors);var r=[];for(var t in e)"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?r=maternalLeaveArray:"MaternalDeath"==currentVariable?r=[100,500,1e3,5e3,5e4]:"FemaleLaborForceTotal"==currentVariable?r=[30,40,45,50,60]:"FemaleLaborForceParticipationRate"==currentVariable?r=[30,50,57,65,100]:"FertilityRate"==currentVariable&&(r=[1.5,2,3,5,8]);return scale.domain(r),scale}function choropleth(e,r){var t=e.properties?e.properties[currentVariable]:e[currentVariable];return t?r(t):"No data"==t?"#ccc":"#ccc"}function setChart(e){var r=d3.select("body").append("svg").attr("width",chartWidth).attr("height",chartHeight).attr("class","chart");chartTitle=d3.select("body").append("text").attr("class","chartTitle");var t=r.selectAll(".square").data(e).enter().append("rect").attr("class",function(e){return"square "+e.code3}).attr("width",squareWidth+"px").attr("height",squareHeight+"px");updateChart(t,e.length,e)}function updateChart(e,r,t){colorize=colorScale(t);var a=0,o=[];for(chartTitle.text(function(){return"MaternalLeave"==currentVariable?title_MaternalLeave:"MaternalDeath"==currentVariable?title_MaternalDeath:"FemaleLaborForceTotal"==currentVariable?title_FemaleLaborForceTotal:"FemaleLaborForceParticipationRate"==currentVariable?title_FemaleLaborForceParticipationRate:"FertilityRate"==currentVariable?title_FertilityRate:void 0}),i=0;i<currentColors.length;i++){var l={color:currentColors[i],count:0};o.push(l)}e.style("fill",function(e){return choropleth(e,colorize)}).attr("x",function(e,r){for(color=choropleth(e,colorize),r=0;r<o.length;r++)o[r].color==color&&(a=o[r].count*(squareWidth+1),o[r].count+=1),("#ccc"==color||void 0==color)&&(a=-1e5);return a}).attr("y",function(e){return color=choropleth(e,colorize),color==currentColors[0]?0:color==currentColors[1]?squareHeight+1:color==currentColors[2]?2*(squareHeight+1):color==currentColors[3]?3*(squareHeight+1):color==currentColors[4]?4*(squareHeight+1):color==currentColors[5]?5*(squareHeight+1):void 0}).on("mouseover",highlightChart).on("mouseout",dehighlight).on("mousemove",moveLabel)}function highlightChart(e){var r=e.properties?e.properties:e;d3.selectAll("."+r.code3).style("fill","#f7eb3e");var t,a=r[currentVariable]+"<br>"+currentVariable;t=void 0==r.name_long?r.Country:r.name_long,1==Boolean(r[currentVariable])?"MaternalLeave"==currentVariable?a=r[currentVariable]:"MaternalDeath"==currentVariable?a="1 in "+r[currentVariable]+"<br>women die from maternal causes":"FemaleLaborForceTotal"==currentVariable?a=Math.round(r[currentVariable])+"% of the labor force is composed of women":"FemaleLaborForceParticipationRate"==currentVariable?a=Math.round(r[currentVariable])+"% of women work":"FertilityRate"==currentVariable&&(a=Math.round(10*r[currentVariable])/10+"<br>Average Number of Children Per Woman"):a="No data";d3.select("body").append("div").attr("class","infoLabel").attr("id",r.code3+"label").html(t).append("div").html(a).attr("class","labelName")}function highlight(e){var r=e.properties?e.properties:e;d3.selectAll("."+r.code3).style("fill","#f7eb3e");var t,a=r[currentVariable]+"<br>"+currentVariable;t=void 0==r.name_long?r.Country:r.name_long,1==Boolean(r[currentVariable])?"MaternalLeave"==currentVariable?a=r[currentVariable]:"MaternalDeath"==currentVariable?a="1 in "+r[currentVariable]+"<br>women die from maternal causes":"FemaleLaborForceTotal"==currentVariable?a=Math.round(r[currentVariable])+"% of the labor force is composed of women":"FemaleLaborForceParticipationRate"==currentVariable?a=Math.round(r[currentVariable])+"% of women work":"FertilityRate"==currentVariable&&(a=Math.round(10*r[currentVariable])/10+"<br>Average Number of Children Per Woman"):a="No data";d3.select("body").append("div").attr("class","infoLabel").attr("id",r.code3+"label").html(t).append("div").html(a).attr("class","labelName")}function dehighlight(e){var r=e.properties?e.properties:e,t=d3.selectAll("."+r.code3),a=t.select("desc").text();t.style("fill",a);d3.select("#"+r.code3+"label").remove()}function moveLabel(){var e=d3.event.clientX<window.innerWidth-245?d3.event.clientX+10:d3.event.clientX-210,r=d3.event.clientY<window.innerHeight-100?d3.event.clientY-75:d3.event.clientY-175;d3.select(".infoLabel").style("margin-left",e+"px").style("margin-top",r+"px")}function createDescriptions(){var e=d3.select("body").append("div").attr("class","descriptionDiv");descriptionTitle=e.append("text").html(function(){return"MaternalLeave"==currentVariable?title_MaternalLeave+"<br>":"MaternalDeath"==currentVariable?title_MaternalDeath+"<br>":"FemaleLaborForceTotal"==currentVariable?title_FemaleLaborForceTotal+"<br>":"FemaleLaborForceParticipationRate"==currentVariable?title_FemaleLaborForceParticipationRate+"<br>":"FertilityRate"==currentVariable?title_FertilityRate+"<br>":void 0}).attr("class","descriptionTitle"),description=e.append("text").text(function(){return"MaternalLeave"==currentVariable?desc_MaternalLeave:void 0}).attr("class","description")}function updateDescriptions(){}function about(){d3.select("body").append("text").attr("x",500).attr("y",40).text("About this project:").attr("class","about")}var keyArray=["MaternalLeave","MaternalDeath","FemaleLaborForceTotal","FemaleLaborForceParticipationRate","FertilityRate"];ordinalColorArray=["#fb6a4a","#bcbddc","#9e9ac8","#756bb1","#54278f","#ccc"],deathColorArray=["#54278f","#756bb1","#9e9ac8","#bcbddc","#dadaeb"],colorArray=["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],maternalLeaveArray=["No paid leave","Less than 14 weeks","14 - 25 weeks","26 - 51 weeks","52 weeks or more","No data"];var currentVariable=keyArray[0],currentColors=[],jsonCountries,colorize,mapWidth=1e3,mapHeight=500,chartTitle,squareWidth=10,squareHeight=25,chartWidth=900,chartHeight=5*squareHeight+5,scale,description,title_MaternalLeave="Maternity Leave Law",title_MaternalDeath="Lifetime Risk of Maternal Death",title_FemaleLaborForceTotal="Women as Percentage of Labor Force",title_FemaleLaborForceParticipationRate="Women Labor Force Participation Rate",title_FertilityRate="Fertility Rate",desc_MaternalLeave="Workplace policies before and after childbirth - Length of Paid Maternal Leave",range,ifChart;window.onload=initialize();