function initialize(){setMap()}function setMap(){function e(e,t,n){for(var i=colorScale(t),l=n.objects.countries.geometries,o=0;o<t.length;o++)for(var c=t[o],s=c.CountryCode,d=0;d<l.length;d++)if(l[d].properties.code3==s){for(var u in keyArray)if("MaternalLeave"==keyArray[u]||"PaternalLeave"==keyArray[u]){var p=keyArray[u],h=c[p];l[d].properties[p]=h}else if("FertilityRate"==keyArray[u]){var p=keyArray[u],h=Math.round(10*c[p])/10;l[d].properties[p]=h}else{var p=keyArray[u],h=Math.round(parseFloat(c[p]));l[d].properties[p]=h}break}var n=r.selectAll(".countries").data(topojson.feature(n,n.objects.countries).features).enter().append("path").attr("class",function(e){return"countries "+e.properties.code3}).attr("d",function(e){return a(e)}).style("fill",function(e){return choropleth(e,i)}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel).append("desc").text(function(e){return choropleth(e,i)});setChart(t,i)}{var r=d3.select("body").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","map"),t=d3.geo.naturalEarth().scale(150).translate([mapWidth/2,mapHeight/2]).precision(.1),a=d3.geo.path().projection(t),n=d3.geo.graticule();r.append("path").datum(n.outline).attr("class","gratBackground").attr("d",a),r.selectAll(".gratLines").data(n.lines).enter().append("path").attr("class","gratLines").attr("d",a)}queue().defer(d3.csv,"data/maternityData.csv").defer(d3.json,"data/countries.topojson").await(e)}function setChart(e){{var r=d3.select("body").append("svg").attr("width",chartWidth).attr("height",chartHeight).attr("class","chart");r.append("text").attr("x",20).attr("y",40).attr("class","chartTitle"),r.selectAll(".bar").data(e).enter().append("rect").sort(function(e,r){return e[currentVariable]-r[currentVariable]}).attr("class",function(e){return"bar "+e.CountryCode}).attr("width",chartWidth/e.length-1)}}function colorScale(e){var r;r="MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?d3.scale.ordinal().range(["#DE872C","#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"]):d3.scale.quantile().range(["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"]);var t=[];for(var a in e)"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?t.push(currentVariable):t.push(Number(e[a][currentVariable]));return r.domain(t),r}function choropleth(e,r){var t=e.properties?e.properties[currentVariable]:e[currentVariable];return t?r(t):"#ccc"}function highlight(e){var r=e.properties?e.properties:e;d3.selectAll("."+r.code3).style("fill","#ebfa7b");var t=r[currentVariable]+"<br>"+currentVariable,a=r.name;1==Boolean(r[currentVariable])?"MaternalLeave"==currentVariable?t=r[currentVariable]:"MaternalDeath"==currentVariable?t="1 in "+r[currentVariable]+"<br>women die from maternal causes":"FemaleLaborForceTotal"==currentVariable?t=r[currentVariable]+"%<br> of the labor force is composed of women":"FemaleLaborForceParticipationRate"==currentVariable?t=r[currentVariable]+"%<br> of women work":"FertilityRate"==currentVariable&&(t=r[currentVariable]+"<br>Average Number of Children Per Woman"):t="No data";d3.select("body").append("div").attr("class","infoLabel").attr("id",r.code3+"label").html(a).append("div").html(t).attr("class","labelName")}function dehighlight(e){var r=e.properties?e.properties:e,t=d3.selectAll("."+r.code3).style("fill","#ebfa7b"),a=t.select("desc").text();t.style("fill",a);d3.select("#"+r.code3+"label").remove()}function moveLabel(){var e=d3.event.clientX<window.innerWidth-245?d3.event.clientX+10:d3.event.clientX-210,r=d3.event.clientY<window.innerHeight-100?d3.event.clientY-75:d3.event.clientY-175;d3.select(".infoLabel").style("margin-left",e+"px").style("margin-top",r+"px")}var keyArray=["MaternalLeave","PaternalLeave","MaternalDeath","FemaleLaborForceTotal","FemaleLaborForceParticipationRate","FertilityRate"],currentVariable=keyArray[5],jsonCountries,colorize,mapWidth=850,mapHeight=450,chartWidth=840,chartHeight=150;window.onload=initialize();