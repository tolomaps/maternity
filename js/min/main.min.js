function initialize(){setMap()}function setMap(){function e(e,a,r){for(var n=colorScale(a),i=r.objects.countries.geometries,l=0;l<a.length;l++)for(var c=a[l],s=c.CountryCode,u=0;u<i.length;u++)if(i[u].properties.code3==s){for(var p in keyArray)if("MaternalLeave"==keyArray[p]||"PaternalLeave"==keyArray[p]){var d=keyArray[p],v=c[d];i[u].properties[d]=v}else{var d=keyArray[p],v=Math.round(parseFloat(c[d]));i[u].properties[d]=v}break}var r=t.selectAll(".countries").data(topojson.feature(r,r.objects.countries).features).enter().append("path").attr("class",function(e){return"countries "+e.properties.code3}).attr("d",function(e){return o(e)}).style("fill",function(e){return choropleth(e,n)})}{var a=1200,r=600,t=d3.select("body").append("svg").attr("width",a).attr("height",r).attr("class","map"),n=d3.geo.naturalEarth().scale(150).translate([a/2,r/2]).precision(.1),o=d3.geo.path().projection(n),i=d3.geo.graticule().step([20,20]);t.append("path").datum(i.outline).attr("class","gratBackground").attr("d",o),t.selectAll(".gratLines").data(i.lines).enter().append("path").attr("class","gratLines").attr("d",o)}queue().defer(d3.csv,"data/maternityData.csv").defer(d3.json,"data/countries.topojson").await(e)}function colorScale(e){var a;a="MaternalLeave"==e[t][currentVariable]||"PaternalLeave"==e[t][currentVariable]?d3.scale.ordinal().range(["#DE872C","#FFE2DF","#E5B3C3","#AD6E97","#754773","#29182B"]):d3.scale.quantile().range(["#FFE2DF","#E5B3C3","#AD6E97","#754773","#29182B"]);var r=[];for(var t in e)"MaternalLeave"==e[t][currentVariable]||"PaternalLeave"==e[t][currentVariable]?r.push(e[t][currentVariable]):r.push(Number(e[t][currentVariable]));return a.domain(r),a}function choropleth(e,a){var r=e.properties?e.properties[currentVariable]:e[currentVariable];return r?a(r):"#ccc"}var keyArray=["MaternalLeave","PaternalLeave","MaternalDeath","FemaleLaborForceTotal","FemaleLaborForceParticipationRate","FertilityRate"],currentVariable=keyArray[2],jsonCountries,colorize;window.onload=initialize();