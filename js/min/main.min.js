function initialize(){setMap()}function setMap(){function e(e,t,o){for(var l=colorScale(t),n=o.objects.countries.geometries,c=0;c<t.length;c++)for(var i=t[c],s=i.CountryCode,u=0;u<n.length;u++)if(n[u].properties.code3==s){for(var d in keyArray)if("MaternalLeave"==keyArray[d]||"PaternalLeave"==keyArray[d]){var h=keyArray[d],p=i[h];n[u].properties[h]=p}else if("FertilityRate"==keyArray[d]){var h=keyArray[d],p=Math.round(10*i[h])/10;n[u].properties[h]=p}else{var h=keyArray[d],p=Math.round(parseFloat(i[h]));n[u].properties[h]=p}break}var o=r.selectAll(".countries").data(topojson.feature(o,o.objects.countries).features).enter().append("path").attr("class",function(e){return"countries "+e.properties.code3}).attr("d",function(e){return a(e)}).style("fill",function(e){return choropleth(e,l)}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel).append("desc").text(function(e){return choropleth(e,l)});createDropdown(t),setChart(t,l)}{var r=d3.select("body").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","map"),t=(d3.select("body").append("text").attr("class","pageTitle").html("Catchy Title Here"),d3.geo.naturalEarth().scale(170).translate([mapWidth/2,mapHeight/2]).precision(.1)),a=d3.geo.path().projection(t),o=d3.geo.graticule();r.append("path").datum(o.outline).attr("class","gratBackground").attr("d",a),r.selectAll(".gratLines").data(o.lines).enter().append("path").attr("class","gratLines").attr("d",a)}queue().defer(d3.csv,"data/maternityData.csv").defer(d3.json,"data/countries.topojson").await(e)}function createDropdown(e){var r=d3.select("body").append("div").attr("class","dropdown").html("<h3>Pick Your Poison:</h3>").append("select").on("change",function(){changeAttribute(this.value,e)});r.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return"MaternalLeave"==e?e="Maternity Leave Law":"PaternalLeave"==e?e="Paternity Leave Law":"MaternalDeath"==e?e="Lifetime Risk of Maternal Death":"FemaleLaborForceTotal"==e?e="Women as Percentage of Labor Force":"FemaleLaborForceParticipationRate"==e?e="Women Labor Force Participation Rate":"FertilityRate"==e&&(e="Fertility Rate"),e})}function changeAttribute(e,r){currentVariable=e,colorize=colorScale(r),d3.selectAll(".countries").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)});d3.selectAll(".square").style("fill",function(e){return choropleth(e,colorize)})}function colorScale(e){"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?(scale=d3.scale.ordinal(),currentColors=ordinalColorArray):"MaternalDeath"==currentVariable?(scale=d3.scale.quantile(),currentColors=deathColorArray):(scale=d3.scale.quantile(),currentColors=colorArray),scale=scale.range(currentColors);var r=[];for(var t in e)"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?r.push(currentVariable):r.push(Number(e[t][currentVariable]));return scale.domain(r),scale}function choropleth(e,r){var t=e.properties?e.properties[currentVariable]:e[currentVariable];return t?r(t):"#ccc"}function setChart(e){var r=d3.select("body").append("svg").attr("width",chartWidth).attr("height",chartHeight).attr("class","chart"),t=(r.append("text").attr("x",20).attr("y",40).attr("class","chartTitle").text("Chart Title"),r.selectAll(".square").data(e).enter().append("rect").attr("class",function(e){return"square "+e.code3}).attr("width","10px").attr("height","10px"));updateChart(t,e.length,e)}function updateChart(e,r,t){colorize=colorScale(t);var a,o=[];for(i=0;i<currentColors.length;i++){var l={color:currentColors[i],count:0};o.push(l)}e.style("fill",function(e){return choropleth(e,colorize)}).attr("class","squareColor").attr("x",function(e,r){for(color=choropleth(e,colorize),r=0;r<o.length;r++)o[r].color==color&&(a=11*o[r].count,o[r].count+=1);return a}).attr("y",function(e){return color=choropleth(e,colorize),console.log(this),color==currentColors[0]?this.x>chartWidth?10:0:color==currentColors[1]?this.x>chartWidth?110:100:color==currentColors[2]?200:color==currentColors[3]?300:color==currentColors[4]?400:color==currentColors[5]?500:void 0})}function highlight(e){var r=e.properties?e.properties:e;d3.selectAll("."+r.code3).style("fill","#f7eb3e");var t=r[currentVariable]+"<br>"+currentVariable,a=r.name_long;1==Boolean(r[currentVariable])?"MaternalLeave"==currentVariable?t=r[currentVariable]:"MaternalDeath"==currentVariable?t="1 in "+r[currentVariable]+"<br>women die from maternal causes":"FemaleLaborForceTotal"==currentVariable?t=r[currentVariable]+"% of the labor force is composed of women":"FemaleLaborForceParticipationRate"==currentVariable?t=r[currentVariable]+"% of women work":"FertilityRate"==currentVariable&&(t=r[currentVariable]+"<br>Average Number of Children Per Woman"):t="No data";d3.select("body").append("div").attr("class","infoLabel").attr("id",r.code3+"label").html(a).append("div").html(t).attr("class","labelName")}function dehighlight(e){var r=e.properties?e.properties:e,t=d3.selectAll("."+r.code3).style("fill","#f7eb3e"),a=t.select("desc").text();t.style("fill",a);d3.select("#"+r.code3+"label").remove()}function moveLabel(){var e=d3.event.clientX<window.innerWidth-245?d3.event.clientX+10:d3.event.clientX-210,r=d3.event.clientY<window.innerHeight-100?d3.event.clientY-75:d3.event.clientY-175;d3.select(".infoLabel").style("margin-left",e+"px").style("margin-top",r+"px")}var keyArray=["MaternalLeave","MaternalDeath","FemaleLaborForceTotal","FemaleLaborForceParticipationRate","FertilityRate"];ordinalColorArray=["#fb6a4a","#ccc","#bcbddc","#54278f","#9e9ac8","#756bb1"],deathColorArray=["#54278f","#756bb1","#9e9ac8","#bcbddc","#dadaeb"],colorArray=["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],maternalLeaveArray=["No data","No paid leave","Less than 14 weeks","14 - 25 weeks","26 - 51 weeks","52 weeks or more"];var currentVariable=keyArray[0],currentColors=[],jsonCountries,colorize,mapWidth=1e3,mapHeight=500,chartWidth=200,chartHeight=500,scale,range;window.onload=initialize();