function initialize(){setMap()}function setMap(){function e(e,a,n){for(var o=colorScale(a),l=n.objects.countries.geometries,i=0;i<a.length;i++)for(var c=a[i],s=c.CountryCode,d=0;d<l.length;d++)if(l[d].properties.code3==s){for(var u in keyArray)if("MaternalLeave"==keyArray[u]||"PaternalLeave"==keyArray[u]){var h=keyArray[u],p=c[h];l[d].properties[h]=p}else if("FertilityRate"==keyArray[u]){var h=keyArray[u],p=Math.round(10*c[h])/10;l[d].properties[h]=p}else{var h=keyArray[u],p=Math.round(parseFloat(c[h]));l[d].properties[h]=p}break}var n=t.selectAll(".countries").data(topojson.feature(n,n.objects.countries).features).enter().append("path").attr("class",function(e){return"countries "+e.properties.code3}).attr("d",function(e){return r(e)}).style("fill",function(e){return choropleth(e,o)}).on("mouseover",highlight).on("mouseout",dehighlight).on("mousemove",moveLabel).append("desc").text(function(e){return choropleth(e,o)});createDropdown(a),setChart(a,o)}{var t=d3.select("body").append("svg").attr("width",mapWidth).attr("height",mapHeight).attr("class","map"),a=(d3.select("body").append("text").attr("class","pageTitle").html("It Ain't Easy Having a Vagina"),d3.geo.naturalEarth().scale(170).translate([mapWidth/2,mapHeight/2]).precision(.1)),r=d3.geo.path().projection(a),n=d3.geo.graticule();t.append("path").datum(n.outline).attr("class","gratBackground").attr("d",r),t.selectAll(".gratLines").data(n.lines).enter().append("path").attr("class","gratLines").attr("d",r)}queue().defer(d3.csv,"data/maternityData.csv").defer(d3.json,"data/countries.topojson").await(e)}function createDropdown(e){var t=d3.select("body").append("div").attr("class","dropdown").html("<h3>Pick Your Poison:</h3>").append("select").on("change",function(){changeAttribute(this.value,e)});t.selectAll("options").data(keyArray).enter().append("option").attr("value",function(e){return e}).text(function(e){return"MaternalLeave"==e?e="Maternity Leave Law":"PaternalLeave"==e?e="Paternity Leave Law":"MaternalDeath"==e?e="Lifetime Risk of Maternal Death":"FemaleLaborForceTotal"==e?e="Women as Percentage of Labor Force":"FemaleLaborForceParticipationRate"==e?e="Women Labor Force Participation Rate":"FertilityRate"==e&&(e="Fertility Rate"),e})}function changeAttribute(e,t){currentVariable=e,colorize=colorScale(t),d3.selectAll(".countries").style("fill",function(e){return choropleth(e,colorize)}).select("desc").text(function(e){return choropleth(e,colorize)})}function colorScale(e){scale="MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?d3.scale.ordinal().range(ordinalColorArray):"MaternalDeath"==currentVariable?d3.scale.quantile().range(deathColorArray):d3.scale.quantile().range(colorArray);var t=[];for(var a in e)"MaternalLeave"==currentVariable||"PaternalLeave"==currentVariable?t.push(currentVariable):t.push(Number(e[a][currentVariable]));return scale.domain(t),scale}function choropleth(e,t){var a=e.properties?e.properties[currentVariable]:e[currentVariable];return a?t(a):"#ccc"}function setChart(e){{var t=d3.select("body").append("svg").attr("width",chartWidth).attr("height",chartHeight).attr("class","chart");t.append("text").attr("x",20).attr("y",40).attr("class","chartTitle"),t.selectAll(".bar").data(e).enter().append("rect").sort(function(e,t){return e[currentVariable]-t[currentVariable]}).attr("class",function(e){return"bar "+e.CountryCode}).attr("width",chartWidth/e.length-1).attr("height",chartHeight/e.length-1)}d3.select(".chartTitle").text("Chart Title")}function updateChart(){}function highlight(e){var t=e.properties?e.properties:e;d3.selectAll("."+t.code3).style("fill","#f7eb3e");var a=t[currentVariable]+"<br>"+currentVariable,r=t.name_long;1==Boolean(t[currentVariable])?"MaternalLeave"==currentVariable?a=t[currentVariable]:"MaternalDeath"==currentVariable?a="1 in "+t[currentVariable]+"<br>women die from maternal causes":"FemaleLaborForceTotal"==currentVariable?a=t[currentVariable]+"% of the labor force is composed of women":"FemaleLaborForceParticipationRate"==currentVariable?a=t[currentVariable]+"% of women work":"FertilityRate"==currentVariable&&(a=t[currentVariable]+"<br>Average Number of Children Per Woman"):a="No data";d3.select("body").append("div").attr("class","infoLabel").attr("id",t.code3+"label").html(r).append("div").html(a).attr("class","labelName")}function dehighlight(e){var t=e.properties?e.properties:e,a=d3.selectAll("."+t.code3).style("fill","#f7eb3e"),r=a.select("desc").text();a.style("fill",r);d3.select("#"+t.code3+"label").remove()}function moveLabel(){var e=d3.event.clientX<window.innerWidth-245?d3.event.clientX+10:d3.event.clientX-210,t=d3.event.clientY<window.innerHeight-100?d3.event.clientY-75:d3.event.clientY-175;d3.select(".infoLabel").style("margin-left",e+"px").style("margin-top",t+"px")}var keyArray=["MaternalLeave","MaternalDeath","FemaleLaborForceTotal","FemaleLaborForceParticipationRate","FertilityRate"];ordinalColorArray=["#fb6a4a","#ccc","#bcbddc","#54278f","#9e9ac8","#756bb1"],deathColorArray=["#54278f","#756bb1","#9e9ac8","#bcbddc","#dadaeb"],colorArray=["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],maternalLeaveArray=["No data","No paid leave","Less than 14 weeks","14 - 25 weeks","26 - 51 weeks","52 weeks or more"];var currentVariable=keyArray[0],jsonCountries,colorize,mapWidth=1e3,mapHeight=500,chartWidth=200,chartHeight=500,scale;window.onload=initialize();